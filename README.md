# Heart-Monitor

During our third semester, we successfully designed an Analog Heart Rate Monitor, bringing together the realms of technology and healthcare. The project was also showcased for **EXMO'23** the flagship technological exhibition of the University of Moratuwa as a biomedical application of electronics and technology. 

Our team, consisting of Malith, Ravindu, Umesha, and Dilupa, were able to apply our knowledge of circuit design, PCB design, enclosure design, and software integration to create a device that progresses from sensing the heart rate to amplifying and filtering the signal, culminating in the display of the refined waveform. The main circuitry of the device was developed utilizing analog electronic components, as a learning opportunity of analog electronics as well. 

With the user-friendly interface, we were able to output a patient's ECG waveform in real-time and also tune the signal when necessary. Our project's output results were compared favorably and accurately to a commercial patient monitor. With the wealth of practical and hands-on experience we've acquired, we are poised to continue making impactful contributions to the advancement of healthcare through technology.

![Final Product](https://github.com/RavinduMPK/Heart-Rate-Monitor/assets/68577937/454fb58f-91da-467a-b9a8-bbf21c9933de)


What you can find here:

- Circuit Design
- Simulation Files
- Schematic Diagrams
- PCB Designs
- Enclosure Designs
- Arduino program file

  
## The Circuit Design
The ECG circuit mainly consists of 5 blocks. Those are,
- Right Leg Drive Circuit
- Instrumentation Amplifier
- Low Pass Filter
- High Pass Filter
- Notch Filter

When we discuss our design approach to the circuit;

### The Right Leg Drive Circuit
The right leg drive circuit (DRL) is used to reduce common-mode interference. Common-mode interference is unwanted electrical noise that is picked up by the ECG electrodes and amplified along with the ECG signal. This noise can obscure the ECG signal and make it difficult to interpret.

The DRL circuit works by injecting a known voltage into the right-leg electrode. This voltage is equal to the common-mode voltage that is being picked up by the other electrodes. The ECG amplifier then subtracts this known voltage from the signal from the other electrodes, effectively canceling out the common-mode noise.

The DRL circuit is typically used in conjunction with other methods of noise reduction, such as filtering and shielding. The choice of which methods to use depends on the specific application.

![Leg Drive](https://github.com/RavinduMPK/Heart-Rate-Monitor/assets/68577937/86a97f20-2295-4d15-8020-3b00e7a9c400)

### Instrumentation Amplifier
An instrumentation amplifier is a critical component in our ECG circuit design. Its primary purpose is to amplify sensitive electrical signals originating from the body while minimizing distortion. This is crucial for accurate ECG signal acquisition since the electrical potentials generated by the heart are extremely low in amplitude.

The instrumentation amplifier consists of multiple operational amplifiers arranged in a specific configuration to achieve high common-mode rejection ratio (CMRR), which helps in removing unwanted noise that is picked up by the electrodes. By effectively amplifying the difference between two input signals while rejecting common-mode signals, the instrumentation amplifier improves the signal-to-noise ratio of the ECG measurement.

In addition to amplifying the ECG signal, the instrumentation amplifier also provides a means to adjust the gain as needed. This enables customization of the signal's amplitude for optimal visualization on the display.

![Instrumentation Amplifier](https://github.com/RavinduMPK/Heart-Rate-Monitor/assets/68577937/015c5d71-d8f8-4ec5-9b28-d0a003c3f251)


### Low Pass Filter
We implemented a 5th order Bessel-Thompson low pass filter in our circuit. This filter is designed to attenuate high-frequency noise and unwanted components beyond a certain cutoff frequency while preserving the integrity of the ECG signal. The Bessel filter is chosen for its minimal group delay, which helps maintain the shape and timing of the ECG waveform.

The Bessel-Thompson filter comprises a series of cascaded first-order and second-order active filter stages. These stages collectively contribute to the filter's response, ensuring that frequencies beyond the cutoff are effectively attenuated while minimizing distortion and phase shift. By carefully selecting the filter's components and structure, we ensure that the amplified ECG signal is clean and devoid of high-frequency noise.

![Low Pass filter](https://github.com/RavinduMPK/Heart-Rate-Monitor/assets/68577937/13c71354-1cb5-4124-a9d2-e7441a87ed54)


### High Pass Filter
Our ECG circuit incorporates a 3rd order active inverting Butterworth high-pass filter. This filter serves multiple purposes, including removing the DC offset that may develop between the electrodes and further amplifying the signal.

The high-pass filter's design focuses on attenuating low-frequency components, which typically include DC offset and slow baseline drift. The filter's configuration involves a cascade of a second-order active non-inverting stage followed by a first-order active inverting stage. The combined effect of these stages results in eliminating DC offset while providing additional signal amplification.

A variable resistor is integrated into the high-pass filter, allowing us to adjust the gain of the first-order filter stage according to the requirements of the specific ECG measurement.

![High pass filter](https://github.com/RavinduMPK/Heart-Rate-Monitor/assets/68577937/19fe519a-622e-497f-89b8-971e35396121)


### Notch Filter
To eliminate the interference caused by the 50 Hz power line frequency, we integrated a Twin-T type notch filter into our ECG circuit.

The Twin-T notch filter is known for its ability to provide a deep notch at a specific frequency, making it effective at eliminating power line interference. In our case, the notch frequency is set to 50 Hz to target the power line frequency. The filter's quality is determined by the Q factor, which influences the sharpness of the roll-off at the notch frequency.

To accommodate variations in the interference and notch frequency, we included a variable resistor that allows us to adjust the Q factor and achieve optimal filtering. This ensures that the ECG waveform remains free from the influence of power line noise, contributing to accurate and reliable heart rate measurements.

With these components and configurations, our analog heart rate monitor circuit is capable of capturing, amplifying, and filtering the ECG signal to produce a clean and accurate representation of the heart's electrical activity. The combination of the right leg drive circuit, instrumentation amplifier, low pass filter, high pass filter, and notch filter results in a robust ECG measurement system suitable for biomedical applications.

![Notch Filter](https://github.com/RavinduMPK/Heart-Rate-Monitor/assets/68577937/1d7f39b8-2c61-457f-9e86-2a0f7a5d13a9)

## Simulation 
We used LTspice software to simulate and verify our circuit.
![Simulation](https://github.com/RavinduMPK/Heart-Monitor/assets/68577937/e6302d45-ac85-45a4-b084-3bd74ee4f556)


## The Enclosure Design
The enclosure was designed by Solidworks software. It contains a removable top lid, a removable front, and the main body. The removability was integrated to fix and replace components. Holes surrounding the box are integrated to ensure that the heat flow to the outside of the box due to the power components inside. A fan is also connected inside to help with this. The front contains the display and also the knobs for tuning the filters. The switch on top switches off the device, and can be used for temporary situations. And the switch at the back, switches off the transformer as well, saving
the power loss that happens at the transformer. The enclosure also contains holes containing the adapters to connect the power cable and also to
connect the 3.5mm jack.

![Enclosure main](https://github.com/RavinduMPK/Heart-Rate-Monitor/assets/68577937/63fa4ae4-495b-48c7-b518-86d78dae3c7f)
![Enclosure full](https://github.com/RavinduMPK/Heart-Rate-Monitor/assets/68577937/7e869948-9356-44c6-90ee-c38deb6e10b9)
![Enclosure front](https://github.com/RavinduMPK/Heart-Rate-Monitor/assets/68577937/64865f30-f25c-416d-b457-e19af9d8d806)

## PCB Design
The heart rate monitor's PCB design involved several key considerations that contributed to the final product's performance and reliability. One of the pivotal decisions was the configuration of a 4-layer PCB. This choice allowed us to take advantage of its multilayer structure for improved signal integrity, reduced interference, and effective heat dissipation.

The arrangement of the layer stack was meticulously planned to optimize the PCB's performance. By thoughtfully allocating power and ground planes and strategically positioning signal traces, we aimed to create a layout that minimized noise and interference while providing stable voltage references for our sensitive analog components.

In the process of routing traces, special attention was given to the layout's integrity. We took great care to minimize issues such as cross-talk, impedance mismatches, and electromagnetic interference.

![PCB layers](https://github.com/RavinduMPK/Heart-Monitor/assets/68577937/150bae9f-5a67-423e-9dfb-7b03b823cc1d)


The placement of components on the PCB played a vital role in achieving signal fidelity and effective thermal management. Components were arranged to minimize signal distortion and ensure efficient heat dissipation. By considering the interaction between components, we aimed to create a layout that enhanced the overall functionality and reliability of the heart rate monitor.

![PCB](https://github.com/RavinduMPK/Heart-Monitor/assets/68577937/8c99865e-4b09-4ce2-b97c-d1f84e28f4a3)


Upon finalizing the PCB design, we collaborated with JLC PCB, a reputable PCB manufacturer, for production. Their expertise and advanced manufacturing processes ensured the accurate reproduction of our design.

## Testing and Final Results
Throughout the development of our heart rate monitor project, rigorous testing played a pivotal role in ensuring the accuracy and reliability of our device. Initially, we implemented the circuit on breadboards, meticulously connecting components and validating the functionality of each stage. This iterative testing approach allowed us to address any issues early in the design process and refine our circuitry.

![Bread board implementation](https://github.com/RavinduMPK/Heart-Monitor/assets/68577937/c539a9f8-8300-4d57-9779-7e09ab78fd8f)


To observe the ECG waveform and monitor signal behavior, we utilized an oscilloscope. This powerful tool enabled us to visualize the signal characteristics, detect any anomalies, and fine-tune our circuit parameters for optimal performance.

![Testing process](https://github.com/RavinduMPK/Heart-Monitor/assets/68577937/bb8351ab-215e-4faa-a027-d4a9d5e71e0d)


Recognizing the dynamic nature of power line interference, we introduced variable resistors into the notch filter circuit. This innovation provided us with the flexibility to adjust the notch filter frequency as needed. By adapting to variations in interference over time, we could consistently attain a clean and accurate ECG waveform.

After iterative adjustments and thorough testing, we achieved our goal: a heart rate monitor that delivered more accurate and reliable ECG waveforms. The collective efforts of our team, from circuit design and simulation to PCB layout and meticulous testing, culminated in a final product that accurately captures and displays the heart's electrical activity. This accomplishment underscored the success of our project and its potential to make meaningful contributions to healthcare through technology.

![Final result](https://github.com/RavinduMPK/Heart-Monitor/assets/68577937/c25034df-b008-4fa7-9e9e-cfb0dca2fa15)
